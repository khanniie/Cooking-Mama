<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>tracking.js - face with camera</title>
    <!--   <link rel="stylesheet" href="assets/demo.css"> -->
    <script src="tracking/tracking.js"></script>
    <!--    <script src="../node_modules/dat.gui/build/dat.gui.min.js"></script> -->
    <!--   <script src="assets/stats.min.js"></script> -->
    <style>
    video,
    canvas {
        position: absolute;
        left: 20%;
        top: 10%;
    }

    #source {
        opacity: 0;
    }
    </style>
</head>
<body>
<video id="video" width="640" height="480" preload playsinline autoplay muted></video>
            <canvas id="canvas" width="640" height="480"></canvas>
    <script>
        var array = [new Rectangle(0,0,0,0), new Rectangle(0,0,0,0)];
        var count = 0;
        var temprectx = new Rectangle(0,0,0,0);
        var video = document.getElementById('video');
        var front = false;
        var constraints = { video: { facingMode: (front? "user" : "environment") } };
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        tracking.ColorTracker.registerColor('white', function(r,g,b){
            if (( r>200 && g>200 && b>200)){
            return true;
        }
        return false;
        });
        ;
        tracking.ColorTracker.registerColor('black', function(r,g,b){
            if (( r<20 && g<20 && b<20)){
            return true;
        }
        return false;
        });
        var colors = new tracking.ColorTracker(['black']);
        var colored = new tracking.ColorTracker(['white']);
        navigator.mediaDevices.getUserMedia(constraints).then(function(mediastream){
                    video.srcObject = mediastream;
            video.onloadedmetadata = function(e) {
                video.play();
            };
                  tracking.track('video', colored);
                   colored.on('track',function(event){
                                    event.data.forEach(function(rect){
                                        if(count == 4){
                                            context.clearRect(0, 0, canvas.width, canvas.height);
                                        /*if (arethere2rectangles(array[0], array[1]))
                                            console.log("there are 2 rects!");
                                        else
                                            console.log("only one rect");
                                            count = 0;*/
                                        }
                                        array[0].x=rect.x;
                                        array[0].y=rect.y;
                                        array[0].width=rect.width;
                                        array[0].height=rect.height;
                                        context.beginPath();
                                        //console.log(rect.x, rect.y, rect.width, rect.height);
                                        context.rect(rect.x, rect.y, rect.width, rect.height);
                                        context.stroke();
                                        context.closePath();
                                        count++;
                                    });
                                });
                  tracking.track('video', colors);
                   colors.on('track',function(event){
                                    event.data.forEach(function(rect){
                                        if(count == 4){
                                            context.clearRect(0, 0, canvas.width, canvas.height);
                                        /*if (arethere2rectangles(array[0], array[1]))
                                            console.log("there are 2 rects!");
                                        else
                                            console.log("only one rect");
                                            count = 0;
                                        }*/
                                        array[1].x=rect.x;
                                        array[1].y=rect.y;
                                        array[1].width=rect.width;
                                        array[1].height=rect.height;
                                        context.beginPath();
                                        //console.log(rect.x, rect.y, rect.width, rect.height);
                                        context.rect(rect.x, rect.y, rect.width, rect.height);
                                        context.stroke();
                                        context.closePath();
                                        count++;


        });
      });

        })

    function Rectangle(x,y,width, height){
        this.height = height;
        this.width = width;
        this.x = x;
        this.y = y;
    }

    function arethere2rectangles(rect1, rect2){
            if (((rect2.x<=rect1.x && rect2.x+rect2.width > rect1.x) || (rect1.x<=rect2.x && rect1.x+rect1.width > rect2.x)) && 
                ((rect2.y<=rect1.y && rect2.y+rect2.height >rect1.y)|| (rect1.y<=rect2.y && rect1.y+rect1.height > rect2.y))) {
                return false;
            }
            return true;
        }

    function withinrect(rect1, rect2){
        if ((rect1.x >= rect2.x) && (rect1.x + rect1.width <= rect2.x +rect2.width)){
            if ((rect1.y >= rect2.y) && (rect1.y + rect1.height <= rect2.y + rect2.height))
                return true;
        } 
        if ((rect2.x >= rect1.x) && (rect2.x + rect2.width <= rect1.x +rect1.width)){
            if ((rect2.y >= rect1.y) && (rect2.y + rect2.height <= rect1.y + rect1.height))
                return true;
        } 
        return false;
    }
    </script>
</body>